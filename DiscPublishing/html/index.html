<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
	 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

	<head>
		<link href="./style.css" rel="stylesheet" type="text/css" />
	</head>
	<body>
		<div id="plugin_icon"><img src="Plugin.jpg" border="0" /></div>
		<h1>DiscPublishing 1.8</h1>
		<div id="text">
            This plugin allows you to use a Primera DiscPublisher robot with OsiriX.<br/>
            <br/>
            With Primera robots OsiriX will be able to produce labeled CDs and DVDs containing selected DICOM files. The discs' content and label can be customized. The following list enumerates the available options:
            <ul>
                <li>
                    <b>Automatic burn of incoming files</b><br/>
                    Can be enabled/disabled.
                </li>
                <li>
                    <b>Burn delay</b><br/>
                    You can specify how long OsiriX must wait before it starts burning data. The selected delay is applied this way: every time a patient's image is received, that patient's timer is reset, and when a timer reaches the delay the data received for that patient is prepared and burnt.
                </li>
                <li>
                    <b>Label template</b><br/>
                    You can select a <i>Disc Cover 3</i> label template file that will be filled with values extracted from the DICOM files' meta data.
                </li>
                <li>
                    <b>Included DICOM Viewers</b><br/>
                    Weasis and OsiriX Lite can be included on the disc for direct viewing.
                </li>
                <li>
                    <b>DICOM Anonymization</b><br/>
                    The DICOM files can be anonymized before being processed and burnt.
                </li>
                <li>
                    <b>DICOM Compression</b><br/>
                    The DICOM files can be compressed or decompressed.
                </li>
                <li>
                    <b>HTML/QuickTime</b><br/>
                    An HTML version of the DICOM images can be included. Series containing more than one image are included as QuickTime movies.
                </li>
                <li>
                    <b>ZIP compression and encryption</b><br/>
                    To save extra space, you may apply ZIP compression to the data included in the disk. Also, the ZIP file can be protected with a password.
                </li>
                <li>
                    <b>Extra content</b><br/>
                    You may specify a folder whose content is copied on the burnt discs.
                </li>
                <li>
                    <b>Mount & Match</b><br/>
                    You may specify a share to mount and copy from. You will define how files in this share are matched to your patient information, for example by its Accession Number or Patient ID. You can set the plugin to delete these files after usage, and if their availability is optional or compulsory, and how long you want to wait for their availability. Matched PDFs can be encapsulated in DICOM files.
                </li>
                <li>
                    <b>Deletion</b><br/>
                    After a successful burn, OsiriX can be set to delete the DICOM from its database.
                </li>
                <li>
                    <b>Burn speed</b><br/>
                    Can be set from 10% to 100%.
                </li>
            </ul>
            
            Most of these options can have different values for different <i>Services</i>. You can define custom <i>Services</i> in the preferences, and the plugin will select one of them depending on the target AET of incoming DICOM images.
            
            <h2>What you need</h2>
            <ul>
                <li>
                    <b>A primera Disc Publisher</b><br/>
	                We tested Disc Publisher SE, Pro, Xi, Xi2 and 4100 Series (CD/DVD only, never BluRay).
                </li>
                <li>
                    <b>An Intel Mac running OS X 10.8 to 10.11, with OsiriX 6.0 or newer (we recommend that you always use the latest version available)</b><br/>
                </li>
                <li>
                    <b>The DiscPublishing plugin</b><br/>
                </li>
            </ul>
            
            <h2>Setup</h2>
            
            <ul>
                <li>
                    Link the DiscPublisher's USB cable to the mac, power both units (mac and robot) on
                </li>
                <li>
                    Make sure the DiscPublisher is installed as a printer on the MacOS X System Preferences' <i>Print & Fax</i> panel.<br/>
	                If it isn't, you will need to install the printer drivers, download them here: <a href="http://www.primera.com/primera_printer_drivers.html">http://primera.eu/en/driver/driver.html</a><br/>
                	You probably need to reboot after setting up the printer! The system won't ask you to, but do it.
                </li>
                <li>
                    I'm not sure this is necessary, but check if your DiscPublisher is running its most recent firmware through the printer utility.<br/>
                    If necessary, update it: <a href="http://www.primera.com/firmware_upgrade.html">http://primera.eu/en/driver/firmware.html</a>
                </li>
                <li>
                    Load the input bins with blank CDs/DVDs.
                </li>
            </ul>
            <ul>
                <li>
                    Install the OsiriX application into the /Applications/ folder.
                </li>
                <li>
                    Install the plugin.
                </li>
                <li>
                    Launch OsiriX.
                </li>
            </ul>
            <ul>
                <li>
                    Configure the plugin through its preferences panel in the OsiriX Preferences window.</br>
                    The first thing you want to check is whether the plugin is successfully communicating with the robot. In the preferences panel there is a box labeled <i>Robot Options</i>. If that box says "No robot was found", then there is a problem, otherwise the box offers you an interface to specify what type of disks you put in the robot's input bins.
                </li>
                <li>
                    Currently, only patient mode is implemented. One day, if users will ask for it, we might implement the archiving plugin mode.
                </li>
                <li>
                    The other options are rather intuitive and described on this page's introduction.
                </li>
            </ul>
            <ul>
                <li>
                    If you want to, customize your OsiriX main window's toolbar (right click on toolbar, "Customize Toolbar...") by adding the plugin's "Publish" button to it.
                </li>
                <li>
                    Make sure the <i>Albums & Sources</i> drawer is visible, as the plugin only tells you about its status through the new Activity table, on the bottom of the drawer.
                </li>
            </ul>
            <ul>
                <li><b>
                    If something goes wrong, the plugin will notify you through Growl. If Growl is not installed and active, you may miss important messages. We suggest you set Growl to use the MailMe or SMS display styles for all notifications from the plugin, which shows as Disc Publishing in the Growl preference pane (it will appear only once the plugin will have been run for the first time). 
                </li>
            </b></ul>
            
            Our disc publishing test mac is set to automatically log into a 'discpublishing' user. A launch daemon is set for that user in order to keep OsiriX running. We advise you to do the same.<br/>
            <br/>
            Additionally, we have configured <a href="http://growl.info/downloads">Growl</a> to use the <a href="http://code.google.com/p/growl-mail-smtp/wiki/Documentation">MailMeToo plugin</a> to send emails for all notifications dispatched by the DiscPublishing plugin. This makes unattended usage of the plugin much more practical, as you will receive emails whenever the robot requires an action from you. Growl 1.2.2 works just fine - actually, even better than later versions because of Mac App Store constraints.<br/>
            <br/>
            You may want to activate the OsiriX server mode option, but since version 1.2.2 of this plugin DICOM listener errors are intercepted by the plugin and redirected to Growl (long DICOM transfers could block OsiriX on a <i>DICOM Listener Error</i> modal alert dialog).

             <!--<h2>Customization</h2>
             
            <ul>
                <li>
                    <b>DICOM directory name</b><br/><br/>
  		           The directory containing all DICOM files is by default named <i>DICOM</i>. If you need the DICOM directory to be named differently, you must edit the file at DiscPublishing.osirixplugin/Contents/Info.plist and specify the custom directory name for key <i>DicomDirectoryName</i>.
<pre>&lt;key&gt;DicomDirectoryName&lt;/key&gt;
&lt;string&gt;IMAGES&lt;/string&gt;</pre>
					Warning: if you include Weasis on the disc, beware that Weasis only scans for DICOM files in directories named dicom, DICOM, images and IMAGES.
				</li>--->
                <!--li>
                    <b>Disc cover merge fields</b><br/><br/>
                    The plugin allows you to provide a template for the disc's label. The template editing application, bundled in the plugin, supports the usage of text fields where the content of the fields is filled when the template is used for printing.<br/>
                    By default, the plugin fills these merge fields with these values:
					<br/>
					<br/>
					<ol>
						<li>Disc name (normally the patient's name)</li>
						<li>Patient's birth date</li>
						<li>Study names (if multiple values, these are separated by commas)</li>
						<li>Modalities (if multiple values, these are separated by commas)</li>
						<li>Study dates (if multiple values, these are separated by commas)</li>
						<li>Current date</li>
					</ol>
					<br/>
					These fields are specified in the file at DiscPublishing.osirixplugin/Contents/Info.plist under the key <i>MergeFields</i>:
<pre>&lt;key&gt;MergeFields&lt;/key&gt;
&lt;array&gt;
	&lt;string&gt;%DiscName%&lt;/string&gt;
	&lt;string&gt;%PatientsBirthDate%&lt;/string&gt;
	&lt;string&gt;%StudyDescription%&lt;/string&gt;
	&lt;string&gt;%Modality%&lt;/string&gt;
	&lt;string&gt;%StudyDate%&lt;/string&gt;
	&lt;string&gt;%CurrentDate%&lt;/string&gt;
&lt;/array&gt;</pre>
					
					You can modify these values and add more, up to a maximum total of 10. 
					TODO: list available keys!
					
                </li-->
			</ul>
            
            
            <h2>Tests</h2>
            
            <div>If you already have some DICOM files in your database, select a few of them (of the same patient) and start the publishing process through the toolbar "Publish" button or the "Publish" menu item, under Plugins > Database. Only do this ONCE (otherwise you'll publish more disks).<br/>
            The disk data gets copied, compressed, anonymized, etc, as described in the activity table entry, then you'll see your robot pick a disk, burn it, label it and output it.</div>

            <div>If you activated the "Automatically queue and publish images received via DICOM" checkbox, send some files to OsiriX from another DICOM node (the plugin will publish one disk per patient). When the files arrive, the plugin stacks them and waits until the delay you specified in the preferences is passed since a patient's last received image; then it takes all that patient's images off the stack, and publishes them: the disk data gets copied, compressed, anonymized, etc, as described in the activity table entry, then you'll see your robot pick a disk, burn it, label it and output it.</div>
            
            <h2>XMLRPC</h2>
            
            <div>RIS integration can be done through  XMLRPC calls to OsiriX. This plugin responds to XMLRPC calls as follows:</div>

			<div><ul><li>Method: <b>DPPublish</b><br/>
				This method allows you to start the publishing process by specifying what to publish through the <i>request</i> parameter.
				<ul>
					<li>Parameters: like for other OsiriX XMLRPC methods, one <i>struct</i> containing values the following keys:
						<ul>
							<li><i>request</i>: the value must be a string that respects NSPredicate syntax, used agains the OsiriX database</li>
							<li><i>table</i>: what database entity the predicate is to be matched against either 'Study', 'Series' or 'Image' (you MUST respect the case - for example, lowercase 'image' will fail)</li>
						</ul>
					</li>
					<li>Response: a struct containing the following keys:
						<ul>
							<li><i>error</i>: an integer (careful, OsiriX usually returns this as a string) with the following values:
								<ul>
									<li>0: publishing process successfully started, key 'count' is also in the response</li>
									<li>-1: key 'request' or 'table' missing in request</li>
									<li>-2: an error occurred while fetching from the database, key 'localizedDescription' gives more details on the error</li>
									<li>-3: database request returned 0 images</li>
									<li>-666: an exception occurred, key 'reason' gives more details on the exception</li>
								</ul>
							</li>
							<li><i>count</i>: available only when <i>error</i> is 0, an integer describing how many images are being published</li>
							<li><i>localizedDescription</i>: available only when <i>error</i> is -2, a string describing the error</li>
							<li><i>reason</i>: available only when <i>error</i> is -666, a string describing the exception</li>
						</ul>
					</li>
					<li>Examples:<ul>
						<li>{request: "accessionNumber = 'A0123456789'", table: "Study"}</li>
						<li>{request: "patientID = '123456'", table: "Study"}</li>
						<li>{request: "study.patientID = '123456', seriesDICOMUID = '1.2.3.4.5.6.7'", table: "Series"}</li>
						<li>osirix://?methodName=DPPublish&table=Study&request="accessionNumber = 'A0123456789'"</li>
						<li>&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;methodCall&gt;&lt;methodName&gt;DPPublish&lt;/methodName&gt;&lt;params&gt;&lt;param&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;table&lt;/name&gt;&lt;value&gt;&lt;string&gt;Study&lt;/string&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;request&lt;/name&gt;&lt;value&gt;&lt;string&gt;accessionNumber = 'A0123456789'&lt;/string&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/param&gt;&lt;/params&gt;&lt;/methodCall&gt;</li>
					</ul></li>
				</ul>
			</li></ul></div>

		 	<h2>Known problems</h2>

            <div>Some users have contacted us, saying that the plugin was unstable and crashed a lot. We have determined that the installation of this plugin through the OsiriX Plugins Manager is currently unstable, and we strongly advise users to perform a manual re-installation of the plugin: <ul>
            	<li>Quit OsiriX</li>
            	<li>Manually download the plugin (warning: plugin manager installs have been found to be origin of problems) from the following URL: <a href="http://osirixplugins.svn.sourceforge.net/viewvc/osirixplugins/DiscPublishing/html/DiscPublishing.osirixplugin.zip">http://osirixplugins.svn.sourceforge.net/viewvc/osirixplugins/DiscPublishing/html/DiscPublishing.osirixplugin.zip</a></li>
            	<li>Unzip the file and place DiscPublishing.osirixplugin in <i>/Library/Application Support/OsiriX/Plugins</i> or <i>~/Library/Application Support/OsiriX/Plugins</i></li>
            	<li>Launch OsiriX and head over to the Disc Publishing Preferences</li>
            </ul></div>
            
                        <div>Generally, it is good to keep a recent version of PTPublisher around to solve mysterious robot problems. Always quit OsiriX before launching PTPublisher, and vice versa.</div>


		 	<h2>Version history</h2>
		 	
            <div>You can access the version history <a href="../Versions.txt">here</a></div>


	    </div>
    </body>
</html>